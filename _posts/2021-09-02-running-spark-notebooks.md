---
keywords: fastai
title: Running Spark with Notebooks
toc: false
badges: true
hide_binder_badge: true
comments: true
sticky_rank: 1
author: "<a href='https://twitter.com/rajkstats'>Raj Kumar</a>"
description: "A quick tutorial on how to Run Spark in Jupyter and Colab Notebooks"
image: /images/copied_from_nb/spark-on-notebook/blog-head.png
categories: [Jupyter, Spark, Notebooks]
nb_path: _notebooks/2021-09-02-running-spark-notebooks.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-02-running-spark-notebooks.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html height="200" max-width="500" file="/images/copied_from_nb/spark-on-notebook/blog-head.png" %}</p>
<h2 id="Motivation">Motivation<a class="anchor-link" href="#Motivation"> </a></h2><p>Lately, I had been working on something which required working with spark and put together an analysis reading a large dataset. Usually at work, I would just simply run the code on <a href="https://docs.databricks.com/notebooks/index.html">Databricks Notebooks</a> / <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark.html">AWS EMR</a> which comes with pre-defined settings and spark installed and you are ready to run your code in notebooks for doing any kind of these adhoc analysis.</p>
<p>In this blog, we would briefly cover how to work interactively with spark in notebook with commonly used languages like <strong>Python</strong>, <strong>R</strong> and <strong>Scala</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Some-Solutions">Some Solutions<a class="anchor-link" href="#Some-Solutions"> </a></h2><p>We will go through the following approaches in this blog:</p>
<ul>
<li><strong>With Docker</strong></li>
<li><strong>Without Docker</strong></li>
<li><strong>Running Spark with Google Colab Notebooks</strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Without-Docker"><strong>Without Docker</strong><a class="anchor-link" href="#Without-Docker"> </a></h3><p>Let's get started without using an docker image first:</p>
<p>With a little bit of browsing, I was going through this <a href="https://medium.com/@roshinijohri/spark-with-jupyter-notebook-on-macos-2-0-0-and-higher-c61b971b5007">medium blog by Roshini</a>. Though there could be multiple ways to do this. This seems to be the easiest and quickest way to get started. And I am pretty sure that I will be revisting this again and again. So it would be super useful to document the steps on how to get started.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Following are few things you can do to run spark on jupyter notebooks:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Follow the steps <strong>Inspired From Roshni's Blog</strong> (For Mac OS users) to run spark on jupyter notebooks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">apache</span><span class="o">-</span><span class="n">spark</span>
<span class="n">brew</span> <span class="n">info</span> <span class="n">apache</span><span class="o">-</span><span class="n">spark</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since I've already installed spark on my system, I would just go ahead and print the ouptut of info spark which should look like below if you have sucessfully installed spark</p>
<p><img src="/images/copied_from_nb/spark-on-notebook/spark-info.png" alt="spark info">
{% include important.html content='Based on when and which version your system installs spark, change the version in export command below' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">unset</span> <span class="n">SPARK_HOME</span>  <span class="p">(</span><span class="n">only</span> <span class="k">if</span> <span class="n">you</span> <span class="n">have</span> <span class="n">installed</span> <span class="n">spark</span> <span class="n">earlier</span><span class="p">)</span>
<span class="n">export</span> <span class="n">SPARK_HOME</span><span class="o">=</span> <span class="s2">&quot;/usr/local/Cellar/apache-spark/3.1.2/libexec/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Also, make sure you have pyspark python package installed:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pip3</span><span class="o">.</span><span class="mi">9</span> <span class="n">install</span> <span class="n">pyspark</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/pyspark.png" alt="pyspark"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run <code>pyspark</code> or <code>spark-shell</code> on your terminal to see if spark has configured correctly</p>
<p><img src="/images/copied_from_nb/spark-on-notebook/spark-install.png" alt="spark install"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means that spark is configured, now let's move on to how to interactively run spark with jupyter notebooks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jupyter</span> <span class="n">notebook</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now copy the following the code to the first cell of your jupyter notebook</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">],</span> <span class="s1">&#39;python/pyspark/shell.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/spark-nb.png" alt="spark install"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To access <strong>Spark Application UI</strong>, click on the link available in output of first cell of  jupyter notebook</p>
<p><img src="/images/copied_from_nb/spark-on-notebook/spark-app.png" alt="spark install"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="With-Docker"><strong>With Docker</strong><a class="anchor-link" href="#With-Docker"> </a></h3><p>Check out this cool project at Github called <a href="https://github.com/jupyter/docker-stacks">Jupyter Docker Stacks</a>. You can setup environments to work with <strong>Python</strong>, <strong>R</strong> and <strong>Scala</strong> with just the following two steps. This would pull the all spark image from dockerhub.</p>
<p>Look at the detailed documentation <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/index.html">here</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following docker commands to pull the latest image for all spark notebooks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">jupyter</span><span class="o">/</span><span class="nb">all</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">notebook</span><span class="p">:</span><span class="n">latest</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span> <span class="n">jupyter</span><span class="o">/</span><span class="nb">all</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">notebook</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/docker-spark.png" alt="spark install"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Copy the local host link along with the token at the bottom and hit it on your browser</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/jupyter-start.png" alt="spark update"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, you should be able to launch Python, R and Scala (<strong>spylon-kernel</strong>) notebooks respectively and initiate spark session within the notebooks and work interactively</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/all-spark.png" alt="all spark"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="PySpark"><strong>PySpark</strong><a class="anchor-link" href="#PySpark"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/pyspark-session.png" alt="python sc"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="SparkR"><strong>SparkR</strong><a class="anchor-link" href="#SparkR"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/sparkr-session.png" alt="R sc"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Spark-Scala"><strong>Spark Scala</strong><a class="anchor-link" href="#Spark-Scala"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/spark-on-notebook/scala-session.png" alt="Spark scala"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Running-Spark-with-Google-Colab-Notebooks"><strong>Running Spark with Google Colab Notebooks</strong><a class="anchor-link" href="#Running-Spark-with-Google-Colab-Notebooks"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You need to just import all the necessary packages needed to run spark in colab.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include tip.html content='This blog is built with <a href="https://github.com/fastai/fastpages">fastpages</a>. At the top right corner click on Google Colab badge to run this section in colab without any need to copy &amp; paste the code to google colab.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install wget
<span class="o">!</span>apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
<span class="o">!</span>wget -q https://archive.apache.org/dist/spark/spark-3.1.2/spark-3.1.2-bin-hadoop2.7.tgz
<span class="o">!</span>tar xf spark-3.1.2-bin-hadoop2.7.tgz
<span class="o">!</span>pip install -q findspark
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">wget</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.1.2-bin-hadoop2.7&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">findspark</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s1">&#39;ColabPyspark&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">spark</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include tip.html content='Try this section in google colab and share your experience in comments. Thank you for reading !!' %}</p>

</div>
</div>
</div>
</div>
 

